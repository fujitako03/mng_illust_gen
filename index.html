<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆã‚¢ãƒ—ãƒª (HTMLç‰ˆ)</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .api-key-section {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .api-key-section h3 {
            margin-top: 0;
            color: #856404;
        }
        .api-key-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            margin-bottom: 10px;
        }
        .api-key-note {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 0;
        }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        .upload-area:hover {
            border-color: #007bff;
        }
        .upload-area.dragover {
            border-color: #007bff;
            background-color: #f0f8ff;
        }
        #fileInput {
            display: none;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: none;
        }
        .output-section {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .features-output {
            background-color: #f7fafc;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e2e8f0;
            margin: 10px 0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .alert-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .preview-image {
            max-width: 300px;
            max-height: 300px;
            margin: 20px auto;
            display: block;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .generated-image {
            text-align: center;
            margin: 20px 0;
        }
        .generated-image img {
            max-width: 100%;
            max-height: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        /* ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .steps-container {
            margin: 30px 0;
        }
        .step {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        .step.active {
            border-color: #007bff;
            background-color: #e7f3ff;
        }
        .step.completed {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .step-number {
            background-color: #6c757d;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        .step.active .step-number {
            background-color: #007bff;
        }
        .step.completed .step-number {
            background-color: #28a745;
        }
        .step-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        .step-description {
            color: #6c757d;
            margin: 10px 0;
            font-size: 14px;
        }
        .step-content {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆã‚¢ãƒ—ãƒª (HTMLç‰ˆ)</h1>
        <p style="text-align: center; color: #6c757d; margin-bottom: 30px;">
            äººç‰©ç”»åƒã‹ã‚‰7ã¤ã®ç‰¹å¾´ã‚’æŠ½å‡ºã—ã€ã€Œã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«ã€ã®çµ±ä¸€ã•ã‚ŒãŸã‚¤ãƒ©ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¾ã™
        </p>
        
        <!-- API Keyè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="api-key-section">
            <h3>ğŸ”‘ OpenAI API Keyè¨­å®š</h3>
            <input 
                type="password" 
                id="apiKeyInput" 
                class="api-key-input" 
                placeholder="sk-..."
                autocomplete="off"
            >
            
            <div style="margin-top: 15px;">
                <label for="qualitySelect" style="display: block; margin-bottom: 5px; font-weight: bold;">ç”»è³ªè¨­å®š:</label>
                <select id="qualitySelect" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="low">Low (ä½ç”»è³ªãƒ»é«˜é€Ÿ)</option>
                    <option value="mid">Mid (ä¸­ç”»è³ª)</option>
                    <option value="high" selected>High (é«˜ç”»è³ªãƒ»æ¨å¥¨)</option>
                </select>
            </div>
            
            <p class="api-key-note">
                âš ï¸ API Keyã¯ä¸€æ™‚çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹ã¨å‰Šé™¤ã•ã‚Œã¾ã™ã€‚<br>
                API Keyã¯å¤–éƒ¨ã«é€ä¿¡ã•ã‚Œãšã€OpenAI APIã¨ã®é€šä¿¡ã«ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
            </p>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="steps-container">
            <!-- Step 1: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»è§£æ -->
            <div class="step" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                        <h3 class="step-title">ğŸ“¸ äººç‰©ã®ç‰¹å¾´ã‚’æŠ½å‡º</h3>
                        <p class="step-description">
                            äººç‰©ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€è‡ªå‹•ã§7ã¤ã®ç‰¹å¾´ã‚’æŠ½å‡ºã—ã¦ã‚¤ãƒ©ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆAPI Keyå…¥åŠ›å¿…é ˆï¼‰
                        </p>
                    </div>
                </div>
                <div class="step-content">
                    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <p>ğŸ“¸ äººç‰©ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨è‡ªå‹•ã§å‡¦ç†é–‹å§‹</p>
                        <p>ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                        <p><small>PNG, JPG, JPEG, GIF (æœ€å¤§16MB)</small></p>
                    </div>
                    
                    <input type="file" id="fileInput" accept=".png,.jpg,.jpeg,.gif">

                    <!-- è§£æçµæœè¡¨ç¤º -->
                    <div id="step1Results" style="display: none;">
                        <!-- JSONã¯éè¡¨ç¤º -->
                        <div id="featuresResult" style="display: none;"></div>
                        
                        <h4>ğŸ“ æŠ½å‡ºã•ã‚ŒãŸç‰¹å¾´</h4>
                        <div id="yamlResult" class="output-section"></div>
                    </div>
                </div>
            </div>

            <!-- Step 2: ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆ -->
            <div class="step" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div>
                        <h3 class="step-title">ğŸ¨ ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆ</h3>
                        <p class="step-description">
                            æŠ½å‡ºã•ã‚ŒãŸç‰¹å¾´ã¨ã€Œã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«ã€å›ºå®šä»•æ§˜ã‚’çµ„ã¿åˆã‚ã›ã¦çµ±ä¸€æ„Ÿã®ã‚ã‚‹ã‚¤ãƒ©ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¾ã™
                        </p>
                    </div>
                </div>
                <div class="step-content">

                    <!-- ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆçµæœ -->
                    <div id="step2Results" style="display: none;">
                        <h4>ğŸ“ ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h4>
                        <div id="promptResult" class="output-section"></div>
                        
                        <h4>ğŸ–¼ï¸ ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ©ã‚¹ãƒˆ</h4>
                        <div id="generatedImage" class="generated-image"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>å‡¦ç†ä¸­...</p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentFeatures = null;
        let styleGuide = null;

        // ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«ç”Ÿæˆã‚¯ãƒ©ã‚¹ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
        class MinginStyleGuide {
            constructor() {
                // 7ã¤ã®é‡è¦ãªç‰¹å¾´ã®ã¿ã‚’æŠ½å‡ºã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
                this.extractionSchema = {
                    // 1. æœè£…ã®ç¨®é¡ã¨æŸ„
                    clothing: {
                        top: {
                            type: ["Tã‚·ãƒ£ãƒ„", "ãƒ–ãƒ©ã‚¦ã‚¹", "ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„", "ã‚¹ã‚¦ã‚§ãƒƒãƒˆ", "ãƒ‘ãƒ¼ã‚«", "ãƒ—ãƒ«ã‚ªãƒ¼ãƒãƒ¼", "ãƒ–ãƒ¬ã‚¶ãƒ¼", "ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³"],
                            pattern: ["ç„¡åœ°", "ã‚¹ãƒˆãƒ©ã‚¤ãƒ—", "æ ¼å­", "ãƒ‰ãƒƒãƒˆ", "ãƒ­ã‚´"]
                        },
                        bottom: {
                            type: ["ã‚¸ãƒ¼ãƒ³ã‚º", "ãƒãƒãƒ‘ãƒ³", "ãƒ¯ã‚¤ãƒ‰ãƒ‘ãƒ³ãƒ„", "ã‚¹ã‚«ãƒ¼ãƒˆ", "ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹"]
                        }
                    },
                    // 2. é«ªå‹ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ 
                    hair: {
                        style: ["short", "bob", "long", "tied", "curly"],
                        volume: ["flat", "medium", "voluminous"]
                    },
                    // 3. ä½“å‹ã¨ãƒãƒ¼ã‚º
                    silhouette: {
                        body_type: ["slim", "average", "large"],
                        pose: ["standing", "walking", "waving", "holding_item"]
                    },
                    // 4. ãƒ’ã‚²ã®çŠ¶æ…‹ï¼ˆè–„ã„å ´åˆã¯ç„¡ã—ï¼‰
                    beard: {
                        style: ["none", "é¡å…ˆã®ã¿", "å£ã²ã’", "ã‚ã”ã²ã’", "çµ„ã¿åˆã‚ã›"]
                    },
                    // 5. ãƒ¡ã‚¬ãƒã®æœ‰ç„¡
                    glasses: ["none", "round", "square", "thick_frame"],
                    // 6. ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼
                    accessories: {
                        items: ["none", "hat", "bag", "headphones", "watch", "smartphone"]
                    },
                    // 7. å…¨ä½“çš„ãªã‚·ãƒ«ã‚¨ãƒƒãƒˆ
                    overall_silhouette: ["é€†ä¸‰è§’", "é•·æ–¹å½¢", "ç ‚æ™‚è¨ˆ"]
                };

                // ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«å›ºå®šä»•æ§˜ï¼ˆdocs/ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«.yamlã‹ã‚‰ï¼‰
                this.fixedStyleSpecs = {
                    // æç·š
                    line: "ãƒœãƒ¼ãƒ«ãƒšãƒ³ç¨‹åº¦ã®ç´°ã•ã§å‡ä¸€å¹…",
                    // å¡—ã‚Š
                    fill: "ç™½åœ°ï¼‹é»’ãƒ™ã‚¿ã®ï¼’å€¤æ§‹æˆ",
                    // è¦–ç‚¹
                    viewpoint: "å¿…ãšçœŸæ¨ªã¾ãŸã¯3/4ãƒ“ãƒ¥ãƒ¼ï¼ˆæ–œã‚å‘ãï¼‰",
                    // ç›®
                    eyes: "æ¥µå°ã®é»’ãƒ‰ãƒƒãƒˆã€é ­é ‚ã‹ã‚‰é¡ã®1/3ä½ç½®",
                    // é¼»
                    nose: "è¼ªéƒ­ç·šã®ã¿ã€å†…éƒ¨ç·šãªã—",
                    // çœ‰ãƒ»å£ãƒ»è€³
                    facial_features: "çœ‰ãƒ»å£ãƒ»è€³ã¯å®Œå…¨ã«æã‹ãªã„",
                    // é¡”å†…éƒ¨ç·š
                    face_interior: "ç›®ã¨é¼»ä»¥å¤–ã¯ä¸€åˆ‡ã®ç·šã‚’æã‹ãªã„",
                    // é¦–
                    neck: "å¤ªãæãã€ç¾å®Ÿã®1.5å€ç¨‹åº¦ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡",
                    // è‚©
                    shoulders: "æ¥µç«¯ãªãªã§è‚©ï¼ˆ30-45åº¦ä¸‹å‘ãå‚¾æ–œï¼‰",
                    // æµã‚Œ
                    flow: "é¡”â†’é¦–â†’è‚©â†’è…•ã‚’æ»‘ã‚‰ã‹ãªæ›²ç·šã§æ§‹æˆ"
                };
            }

            generateAnalysisPrompt() {
                return `ã“ã®äººç‰©ç”»åƒã‚’è©³ç´°ã«åˆ†æã—ã¦ã€ã€Œã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«ã€ã®ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆã«å¿…è¦ãª7ã¤ã®ç‰¹å¾´ã‚’æ–‡ç« ã§å…·ä½“çš„ã«æå†™ã—ã¦ãã ã•ã„ã€‚

ã€æŠ½å‡ºå¯¾è±¡ã®7ã¤ã®ç‰¹å¾´ã€‘
1. æœè£…ã®ç¨®é¡ã¨æŸ„ - å…·ä½“çš„ãªæœè£…ã¨è‰²ã€æŸ„ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è©³ã—ãæå†™
2. é«ªå‹ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ  - é•·ã•ã€ã‚¹ã‚¿ã‚¤ãƒ«ã€è³ªæ„Ÿã€ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿã‚’è©³ã—ãæå†™  
3. ä½“å‹ã¨ãƒãƒ¼ã‚º - ä½“æ ¼ã€å§¿å‹¢ã€å‹•ä½œã‚’è©³ã—ãæå†™
4. ãƒ’ã‚²ã®çŠ¶æ…‹ - ãƒ’ã‚²ã®æœ‰ç„¡ã€æ¿ƒã•ã€å½¢çŠ¶ã‚’è©³ã—ãæå†™ï¼ˆè–„ã„å ´åˆã¯ã€Œãªã—ã€ï¼‰
5. ãƒ¡ã‚¬ãƒã®æœ‰ç„¡ã¨ç‰¹å¾´ - ãƒ¡ã‚¬ãƒã®å½¢çŠ¶ã€è‰²ã€ç‰¹å¾´ã‚’è©³ã—ãæå†™
6. ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ - èº«ã«ç€ã‘ã¦ã„ã‚‹å°ç‰©é¡ã‚’è©³ã—ãæå†™
7. å…¨ä½“çš„ãªã‚·ãƒ«ã‚¨ãƒƒãƒˆ - ä½“å‹ã®ç‰¹å¾´ã€ãƒãƒ©ãƒ³ã‚¹ã€å°è±¡ã‚’è©³ã—ãæå†™

ã€é‡è¦ãªæŒ‡ç¤ºã€‘
- é¸æŠè‚¢ã«ç¸›ã‚‰ã‚Œãšã€è¦‹ãˆã‚‹ã¾ã¾ã‚’è‡ªç„¶ãªæ–‡ç« ã§å…·ä½“çš„ã«æå†™ã—ã¦ãã ã•ã„
- è‰²ã‚„è³ªæ„Ÿã€å°è±¡ãªã©ã‚‚å«ã‚ã¦è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„
- æ›–æ˜§ãªè¡¨ç¾ã§ã¯ãªãã€å…·ä½“çš„ã§æ˜ç¢ºãªæå†™ã‚’ã—ã¦ãã ã•ã„

ã€JSONå‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®å½¢å¼ã§ã€å„é …ç›®ã‚’è©³ç´°ãªæ–‡ç« ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
{
  "clothing": "æœè£…ã®å…·ä½“çš„ãªæå†™ï¼ˆç¨®é¡ã€è‰²ã€æŸ„ã€ã‚¹ã‚¿ã‚¤ãƒ«ãªã©ï¼‰",
  "hair": "é«ªå‹ã®å…·ä½“çš„ãªæå†™ï¼ˆé•·ã•ã€ã‚¹ã‚¿ã‚¤ãƒ«ã€è³ªæ„Ÿã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ãªã©ï¼‰",
  "body_pose": "ä½“å‹ã¨ãƒãƒ¼ã‚ºã®å…·ä½“çš„ãªæå†™ï¼ˆä½“æ ¼ã€å§¿å‹¢ã€å‹•ä½œãªã©ï¼‰",
  "beard": "ãƒ’ã‚²ã®å…·ä½“çš„ãªæå†™ï¼ˆæœ‰ç„¡ã€æ¿ƒã•ã€å½¢çŠ¶ãªã©ï¼‰",
  "glasses": "ãƒ¡ã‚¬ãƒã®å…·ä½“çš„ãªæå†™ï¼ˆæœ‰ç„¡ã€å½¢çŠ¶ã€è‰²ã€ç‰¹å¾´ãªã©ï¼‰",
  "accessories": "ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã®å…·ä½“çš„ãªæå†™ï¼ˆç¨®é¡ã€ç‰¹å¾´ã€å°è±¡ãªã©ï¼‰",
  "silhouette": "å…¨ä½“ã‚·ãƒ«ã‚¨ãƒƒãƒˆã®å…·ä½“çš„ãªæå†™ï¼ˆä½“å‹ãƒãƒ©ãƒ³ã‚¹ã€å°è±¡ãªã©ï¼‰"
}

JSONã®ã¿ã‚’å›ç­”ã—ã¦ãã ã•ã„ã€‚`;
            }

            // è§£æçµæœã‹ã‚‰ç‰¹å¾´è¦ç´„ã‚’ç”Ÿæˆ
            summarizeFeatures(analyzedFeatures) {
                const summary = {
                    clothing: analyzedFeatures.clothing || 'æœè£…æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',
                    hair: analyzedFeatures.hair || 'é«ªå‹æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',
                    body: analyzedFeatures.body_pose || 'ä½“å‹ãƒ»ãƒãƒ¼ã‚ºæƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',
                    beard: analyzedFeatures.beard || 'ãƒ’ã‚²æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',
                    glasses: analyzedFeatures.glasses || 'ãƒ¡ã‚¬ãƒæƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',
                    accessories: analyzedFeatures.accessories || 'ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',
                    silhouette: analyzedFeatures.silhouette || 'ã‚·ãƒ«ã‚¨ãƒƒãƒˆæƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ'
                };
                return summary;
            }

            // äººç‰©ç‰¹å¾´ã‚’ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§æ•´ç†
            formatFeatures(features) {
                return `ã€æŠ½å‡ºã•ã‚ŒãŸç‰¹å¾´ã€‘

ğŸ§¥ æœè£…
${features.clothing}

ğŸ’‡ é«ªå‹
${features.hair}

ğŸ§ ä½“å‹ãƒ»ãƒãƒ¼ã‚º
${features.body}

ğŸ§” ãƒ’ã‚²
${features.beard}

ğŸ‘“ ãƒ¡ã‚¬ãƒ
${features.glasses}

ğŸ’ ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼
${features.accessories}

ğŸ‘¤ å…¨ä½“ã‚·ãƒ«ã‚¨ãƒƒãƒˆ
${features.silhouette}`;
            }

            // ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«ä»•æ§˜ã«åŸºã¥ãã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            generateIllustrationPrompt(analyzedFeatures) {
                const summary = this.summarizeFeatures(analyzedFeatures);
                
                return `Create an illustration following the exact "ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«" specification:

ã€äººç‰©ã®ç‰¹å¾´ã€‚å³å®ˆã€‘
æœè£…: ${summary.clothing}
é«ªå‹: ${summary.hair}
ä½“å‹ãƒ»ãƒãƒ¼ã‚º: ${summary.body}
ãƒ’ã‚²: ${summary.beard}
ãƒ¡ã‚¬ãƒ: ${summary.glasses}
ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼: ${summary.accessories}
å…¨ä½“ã‚·ãƒ«ã‚¨ãƒƒãƒˆ: ${summary.silhouette}

ã€ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«å›ºå®šä»•æ§˜ã€‚å³å®ˆã€‘
ã¿ã‚“éŠ€ã‚¹ã‚¿ã‚¤ãƒ«:
  ç›®çš„: >-
    ã¿ã‚“ãªã®éŠ€è¡Œã®åºƒå‘Šã‚¤ãƒ©ã‚¹ãƒˆã‚’ã€ã©ã®äººç‰©ãƒ¢ãƒ‡ãƒ«ã§ã‚‚çµ±ä¸€ã•ã‚ŒãŸâ€œã¿ã‚“éŠ€ã‚‰ã—ã•â€ã§
    æãæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã€å…±é€šã™ã‚‹é€ å½¢ãƒ«ãƒ¼ãƒ«ã‚’éšå±¤çš„ã«æ•´ç†ã™ã‚‹ã€‚
    ä½™è¨ˆãªå†™å®Ÿæ€§ã‚’å‰Šãè½ã¨ã—ã€ç·šã¨é¢ã®æœ€å°æ§‹æˆã§ä¸–ç•Œè¦³ã‚’ä¿ã¤ã“ã¨ãŒç‹™ã„ã€‚

  â”€â”€â”€ å…¨ä½“ã‚¹ã‚¿ã‚¤ãƒ« â”€â”€â”€:
    æç·š: >-
      ã™ã¹ã¦ã®è¼ªéƒ­ç·šã‚’ãƒœãƒ¼ãƒ«ãƒšãƒ³ç¨‹åº¦ã®ç´°ã•ã§å‡ä¸€å¹…ã«çµ±ä¸€ã—ã€è§’ã«ã‚ãšã‹ãªä¸¸ã¿ã‚’æ®‹ã—ã¦ç¡¬ã•ã‚’é¿ã‘ã‚‹ã€‚
      æ‰‹æãã®æºã‚‰ãã¯æŠ‘ãˆã€ãƒ™ã‚¸ã‚§ã§æ»‘ã‚‰ã‹ã«å‡¦ç†ã™ã‚‹ã¨ä¸–ç•Œè¦³ãŒå´©ã‚Œãªã„ã€‚
    å¡—ã‚Š: >-
      ã€Œç™½åœ°ï¼‹é»’ãƒ™ã‚¿ã€ã®ï¼’å€¤ã§æ§‹æˆã—ã€å½±ã‚„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯å®Œå…¨ã«æ’é™¤ã™ã‚‹ã€‚
      é»’ãƒ™ã‚¿ã¯ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚’å¼·èª¿ã—ãŸã„è¡£æœã‚„é«ªã®å¡Šã«é™å®šã—ã€
      é»’é¢ç©ãŒå¤šã„äººç‰©ã¨å°‘ãªã„äººç‰©ã‚’æ··åœ¨ã•ã›ã¦ãƒªã‚ºãƒ ã‚’ä½œã‚‹ã€‚
    ä½™ç™½ãƒ»æ§‹å›³: >-
      èƒŒæ™¯ã¯æ½”ã„ç©ºç™½ã¨ã—ã€äººç‰©åˆ—ãªã‚‰æ°´å¹³ã€ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãªã‚‰å¯¾è§’ç·šä¸Šã«
      å¤§èƒ†ãªãƒã‚¬ãƒ†ã‚£ãƒ–ã‚¹ãƒšãƒ¼ã‚¹ã‚’æ®‹ã™ã“ã¨ã§åºƒå‘Šçš„ãªæŠœã‘ã‚’ç¢ºä¿ã™ã‚‹ã€‚

  â”€â”€â”€ äººç‰©è¨­è¨ˆ â”€â”€â”€:
    ä½“å‹ã¨ãƒ—ãƒ­ãƒãƒ¼ã‚·ãƒ§ãƒ³:
      å…±é€šãƒ«ãƒ¼ãƒ«: >-
        ç¾å®Ÿã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¤ã¤è„šã‚’é•·ã‚ã€èƒ´ã‚’çŸ­ã‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ã—ã€
        æ­©å¹…ã‚„é‡å¿ƒç§»å‹•ã‚’å¼·èª¿ã—ã¦å‹•ãã‚’å‡ºã™ã€‚
        è‚©ã€œè…°ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆã¯ã€Œé€†ä¸‰è§’ã€ã€Œé•·æ–¹å½¢ã€ã€Œç ‚æ™‚è¨ˆã€ã®ï¼“åˆ†é¡ã‚’ä¸­å¿ƒã«
        é©åº¦ãªãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒãŸã›ã‚‹ã€‚

    é¡”:
      è¦–ç‚¹ã®å‰æ:
        - æ­£é¢å‘ãã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯å­˜åœ¨ã—ãªã„ã€‚
        - å¿…ãšã€ŒçœŸæ¨ªã€ã¾ãŸã¯ã€Œ3/4ãƒ“ãƒ¥ãƒ¼ï¼ˆæ–œã‚å‘ãï¼‰ã€ã§æãã€‚
      é ­éƒ¨è¼ªéƒ­: >-
        ãƒ™ãƒ¼ã‚¹ã¯ç¸¦é•·ã®åµå½¢
        çœŸæ¨ªå‘ãã§ã‚‚è¼ªéƒ­ç·šã‚’ï¼’ã€œï¼“æ®µéšã§ç·©ãæŠ˜ã‚Šè¿”ã—ã€
        â€œæ£’çŠ¶â€ã«ãªã‚‰ãªã„ã‚ˆã†ã«æ³¨æ„ã™ã‚‹ã€‚
      é«ªã¨ã®å–ã‚Šåˆã„: >-
        é«ªã¨é¡”ã®å¢ƒç•Œã¯ä¸€ç­†æ›¸ãã§ã¤ãªãã€
        ç”Ÿãˆéš›ã‚’æ³¢ç·šãªã©ã§å‡¦ç†ã—ã¦ãƒªã‚ºãƒ ã‚’ä»˜ã‘ã‚‹ã€‚
        é«ªé¢ã¯é»’ãƒ™ã‚¿ã€é¡”é¢ã¯ç™½åœ°ã§å®Œå…¨äºŒå€¤åŒ–ã€‚
      ç›®:
        ã‚µã‚¤ã‚ºã¨å½¢çŠ¶: >-
          çœŸå††ã®é»’ãƒ‰ãƒƒãƒˆã«çµ±ä¸€ã—ã€ç·šã ã‘ã®å††ã‚„ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯å…¥ã‚Œãªã„ã€‚
          ç›®ã§è¦‹ãˆã‚‹ã‚®ãƒªã‚®ãƒªã®å°ã•ã•ã§ãƒœãƒ¼ãƒ«ãƒšãƒ³ã®ç‚¹ã‚’æ‰“ã¤ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚
        é…ç½®: >-
          çœ¼ã®é«˜ã•ã¯é ­é ‚ã‹ã‚‰é¡ã¾ã§ã®1/3ä½ç½®ã«å›ºå®šã™ã‚‹ã¨
          å­ã©ã‚‚ã£ã½ã•ã‚’å›é¿ã—ã¦å¤§äººã®æ¯”ç‡ã«è½ã¡ç€ãã€‚
        å¥¥å´ã®ç›®: >-
          3/4å‘ãã§ã¯é¡”è¼ªéƒ­ç·šã‚ˆã‚Šå†…å´ã«åã‚ãšã€
          ã‚ãˆã¦ã€Œè¼ªéƒ­ç·šã‹ã‚‰1ã€œ2pxæµ®ã‹ã›ã¦ç©ºä¸­ã«æãã€ã€‚
          ç‹¬ç‰¹ã®å¹³é¢æ„Ÿã‚’ç”Ÿã‚€ãŸã‚å¿…ãšå®Ÿæ–½ã€‚
      é¼»:
        è¡¨ç¾æ–¹æ³•:
          é¼»ã¯è¼ªéƒ­ç·šã®ã¿ã§è¡¨ç¾ã—ã€å†…éƒ¨ç·šã¯ä¸€åˆ‡æã‹ãªã„ã€‚
          é¼»å­”ã€å½±ã€ãƒã‚¤ãƒ©ã‚¤ãƒˆãªã©ã®è©³ç´°ã¯å®Œå…¨ã«çœç•¥ã™ã‚‹ã€‚
          é¡”ã®è¼ªéƒ­ã‹ã‚‰è‡ªç„¶ã«çªå‡ºã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªç·šã¨ã—ã¦æãã€‚
        é…ç½®: >-
          3/4ãƒ“ãƒ¥ãƒ¼ã§ã¯é¡”ä¸­å¤®ã‚ˆã‚Šã‚ãšã‹ã«å‰æ–¹ï¼ˆé€²è¡Œæ–¹å‘ï¼‰ã¸å¯„ã›ã‚‹ã€‚
          çœŸæ¨ªãƒ“ãƒ¥ãƒ¼ã§ã¯è¼ªéƒ­å¤–ã«1ã€œ2pxå¼µã‚Šå‡ºã—ã€
          é¼»å…ˆãŒé¡”ã®æœ€å‰ç«¯ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
      çœ‰ãƒ»å£ãƒ»è€³: >-
        ï¼“è¦ç´ ã¨ã‚‚å®Œå…¨ã«æã‹ãªã„ã€‚
        æ„Ÿæƒ…ã‚„è¦–ç·šæ–¹å‘ã¯é¼»ã®å‘ããƒ»é¦–ã®å‚¾ããƒ»è…•ã‚„è‚©ã®å‹•ãã§è£œã†ã€‚
      ãƒ’ã‚²ï¼ˆä»»æ„ï¼‰: >-
        ãƒ’ã‚²ãŒç›®ç«‹ã¤äººç‰©ã®ã¿è¨˜è¿°ã€‚
        ç·šã§è¼ªéƒ­ã‚’åˆ»ã¾ãšã€é¡”è¼ªéƒ­ã¨ä¸€ä½“åŒ–ã•ã›ã¦é¢ã§å‡¦ç†ã™ã‚‹ã€‚
        ãƒ‘ã‚¿ãƒ¼ãƒ³:
          - é¡å…ˆã®ã¿: ã‚ã”å…ˆã®å°ã•ãªä¸‰è§’å½¢çŠ¶ã®é»’ãƒ™ã‚¿
          - å£ã²ã’: é¼»ã¨å£ã®é–“ã®æ¨ªé•·ã®é»’ãƒ™ã‚¿
          - ã‚ã”ã²ã’: é¡ã‹ã‚‰é ¬ã«ã‹ã‘ã¦ã®é»’ãƒ™ã‚¿
          - çµ„ã¿åˆã‚ã›: å£ã²ã’ï¼‹ã‚ã”ã²ã’ãªã©è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çµ„ã¿åˆã‚ã›
      é¡ãƒ»è¼ªéƒ­ä¸‹éƒ¨: >-
        é¦–ã¨ã®å¢ƒç›®ã‚’æ°´å¹³æ°—å‘³ã®ç·šã§åŒºåˆ‡ã‚Šã€
        é¡ä¸‹ã«å½±ç·šã‚„é»’ãƒ™ã‚¿ã‚’å…¥ã‚Œãªã„ã€‚
        é¢é•·å¼·èª¿ãŒå¿…è¦ãªç”·æ€§ã®ã¿ä¸‹é¡å·¦å³ã‚’ã»ã‚“ã®åƒ…ã‹ã«å¼µã‚‹ã€‚
      é¡”ã®å†…éƒ¨ç·šæ’é™¤: >-
        ç›®ï¼ˆå°ã•ãªé»’ãƒ‰ãƒƒãƒˆï¼‰ã¨é¼»ï¼ˆè¼ªéƒ­ã®ã¿ï¼‰ä»¥å¤–ã¯ã€é¡”ã®å†…éƒ¨ã«ä¸€åˆ‡ã®ç·šã‚’æã‹ãªã„ã€‚
        ã»ã†ã‚Œã„ç·šã€ã—ã‚ã€å½±ã€å£å…ƒã®ç·šã€é ¬ã®ç·šãªã©ã¯å®Œå…¨ã«æ’é™¤ã—ã€
        æ¸…æ½”ã§ç°¡æ½”ãªç™½ã„é¢ã§é¡”ã‚’æ§‹æˆã™ã‚‹ã€‚

    é¦–ã¨è‚©ã®æ§‹é€ :
      é¦–: >-
        é¦–ã¯å¤ªãæãã€é ­éƒ¨ã¨ã®è¦–è¦šçš„ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã€‚
        ç¾å®Ÿçš„ãªé¦–ã®å¤ªã•ã‚ˆã‚Š1.5å€ç¨‹åº¦å¤ªããƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ã™ã‚‹ã€‚
        é¦–ã®è¼ªéƒ­ç·šã¯é¡”ã®è¼ªéƒ­ã‹ã‚‰æ»‘ã‚‰ã‹ã«ç¶™ç¶šã™ã‚‹ä¸€æœ¬ç·šã§æãã€‚
      è‚©: >-
        è‚©ã¯æ¥µç«¯ãªãªã§è‚©ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ã—ã€ç¾å®Ÿã‚ˆã‚Šã‚‚å¤§å¹…ã«ä¸‹ãŒã£ãŸè§’åº¦ã§æãã€‚
        è‚©ã®ãƒ©ã‚¤ãƒ³ã¯æ°´å¹³ã‹ã‚‰30-45åº¦ç¨‹åº¦ä¸‹å‘ãã«å‚¾æ–œã•ã›ã‚‹ã€‚
        è‚©å¹…ã¯é©åº¦ã«ä¿ã¡ãªãŒã‚‰ã€ãªã§è‚©ã®ç‰¹å¾´ã‚’å¼·èª¿ã™ã‚‹ã€‚
      å…¨ä½“ã®æµã‚Œ: >-
        é¦–â†’è‚©â†’è…•ã¯ä¸€ã¤ã®æ»‘ã‚‰ã‹ãªæ›²ç·šã¨ã—ã¦æ§‹æˆã—ã€
        è§’å¼µã£ãŸæ¥ç¶šéƒ¨åˆ†ã‚’é¿ã‘ã¦æµå‹•çš„ãªã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚’ä½œã‚‹ã€‚
        å„éƒ¨ä½ã®å¢ƒç•Œç·šã‚‚è‡ªç„¶ã«ç¹‹ãŒã‚‹ã‚ˆã†é…æ…®ã™ã‚‹ã€‚

    é«ªå‹ãƒ‘ã‚¿ãƒ¼ãƒ³:
      å…±é€šæŒ‡é‡: >-
        é«ªã‚’â€œé¢â€ã§æ‰ãˆå¤–å‘¨ã‚’ä¸€æœ¬ç·šã§å›²ã‚€ã€‚
        å†…å´ã«ç·šã¯æã‹ãšã€é»’ã®ãƒ™ã‚¿å¡—ã‚Šã‚‚ã—ãã¯ç™½æŠœãã€‚è³ªæ„Ÿã‚ˆã‚Šã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚’å„ªå…ˆã™ã‚‹ã€‚
        å°ã•ãªãƒãƒã¯æã‹ãšã€ç·©ã„ã‚«ãƒ¼ãƒ–ã‹ã‚‰ãªã‚‹å¡Šã¨ã—ã¦è¡¨ç¾
      ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³:
        - ãƒ‘ãƒ¼ãƒæ„Ÿã®ã‚ã‚‹çŸ­ã„ã‚«ãƒ¼ãƒ«ã‚’é ­é ‚éƒ¨ã«é›†ã‚ã€è€³ã¾ã‚ã‚Šã‚’ã‚¹ãƒƒã‚­ãƒªæãå½¢ã€‚
        - é¦–å…ƒã§è·³ã­ã‚‹ã‚¦ã‚§ãƒ¼ãƒ–ãƒœãƒ–ã€‚å¤–è¼ªã¯ä¸è¦å‰‡ãªã‚¸ã‚°ã‚¶ã‚°ãƒ©ã‚¤ãƒ³ã§å‹•ãã‚’æ¼”å‡ºã€‚
        - è‚©ã‚’è¶…ãˆã‚‹ãƒ­ãƒ³ã‚°ã‚¦ã‚§ãƒ¼ãƒ–ã¯é¢ç©ã‚’ç¢ºä¿ã—â€œãâ€å­—é€£ç¶šã®ãƒ•ãƒªãƒ«ãƒ©ã‚¤ãƒ³ã§å¤–å‘¨ã‚’èµ°ã‚‰ã›ã‚‹ã€‚
        - å¾Œé ­éƒ¨ã«å°ã•ãªå›£å­ã‚’ä½œã‚‹ä¸€æŸçµã³ã€‚é«ªç•™ã‚ã¯ä¸¸ä¸€ç‚¹ã®é»’ã§ç¤ºã™ã€‚
        - ã‚­ãƒ£ãƒƒãƒ—ã‚„ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ã§å‰é«ªã‚’éš ã™å ´åˆã¯é ­é ‚éƒ¨ã®å½¢ã‚’å˜ç´”ãªåŠå††ã§å‡¦ç†ã€‚

    æœè£…ã®ç¨®é¡:
      ãƒˆãƒƒãƒ—ã‚¹:
        Tã‚·ãƒ£ãƒ„: >-
          ç™½æŠœãç·šç”»ã§æãã€ã‚·ãƒ³ãƒ—ãƒ«ãªè¼ªéƒ­ç·šã®ã¿ã§æ§‹æˆã™ã‚‹ã€‚
          èƒ¸å…ƒã«ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆãƒ­ã‚´ã‚„æ–‡å­—ã‚’é»’ãƒ™ã‚¿ã§é…ç½®ã™ã‚‹ã¨ç”»é¢ã«ãƒªã‚ºãƒ ãŒç”Ÿã¾ã‚Œã‚‹ã€‚
        ãƒ–ãƒ©ã‚¦ã‚¹: >-
          è¥Ÿã‚„è¢–å£ã¯ç·šã®ã¿ã§è¡¨ç¾ã—ã€ãƒœã‚¿ãƒ³ã¯å°ã•ãªç‚¹ã§ç¤ºã™ã€‚
          ãƒ•ãƒªãƒ«ã‚„ãƒ¬ãƒ¼ã‚¹ãªã©ã®è£…é£¾ã¯çœç•¥ã—ã€åŸºæœ¬çš„ãªè¼ªéƒ­ç·šã«ç•™ã‚ã‚‹ã€‚
        ãƒ¯ã‚¤ã‚·ãƒ£ãƒ„: >-
          è¥Ÿã¨å‰ç«‹ã¦ï¼ˆãƒœã‚¿ãƒ³éƒ¨åˆ†ï¼‰ã‚’æ˜ç¢ºã«ç·šã§ç¤ºã™ã€‚
          ãƒœã‚¿ãƒ³ã¯ç­‰é–“éš”ã®ç‚¹ã§è¡¨ç¾ã—ã€è¢–å£ã«ã‚«ãƒ•ã‚¹ã®ç·šã‚’è¿½åŠ ã™ã‚‹ã€‚
          ãƒã‚±ãƒƒãƒˆãŒã‚ã‚‹å ´åˆã¯ç·šã®ã¿ã§è¼ªéƒ­ã‚’æãã€‚
        ã‚¹ã‚¦ã‚§ãƒƒãƒˆãƒ»ãƒ‘ãƒ¼ã‚«: >-
          èº«é ƒã‚’å¤§èƒ†ã«é»’ãƒ™ã‚¿ã§å¡—ã‚Šã€è¢–å£ã‚„è£¾ã®ãƒªãƒ–ã ã‘ã‚’ç™½æŠœãç·šã§ç¤ºã™ã€‚
          ãƒ‘ãƒ¼ã‚«ã®å ´åˆã¯ãƒ•ãƒ¼ãƒ‰ã®è¼ªéƒ­ç·šã‚’è¿½åŠ ã™ã‚‹ã€‚
        ãƒ—ãƒ«ã‚ªãƒ¼ãƒãƒ¼: >-
          ãƒ‹ãƒƒãƒˆã®è³ªæ„Ÿã¯è¡¨ç¾ã›ãšã€ã‚·ãƒ³ãƒ—ãƒ«ãªé»’ãƒ™ã‚¿ã¾ãŸã¯ç™½æŠœãã§å‡¦ç†ã™ã‚‹ã€‚
          è¥Ÿå…ƒï¼ˆã‚¯ãƒ«ãƒ¼ãƒãƒƒã‚¯ã‚„Vãƒãƒƒã‚¯ï¼‰ã®å½¢çŠ¶ã®ã¿ã‚’ç·šã§ç¤ºã™ã€‚
        ãƒ–ãƒ¬ã‚¶ãƒ¼ãƒ»ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³: >-
          ãƒœã‚¿ãƒ³ã‚’ç­‰é–“éš”ã®ç‚¹ã§è¡¨ç¾ã—ã€ç¸«ã„ç›®ã‚„ã‚¹ãƒ†ãƒƒãƒã¯æã‹ãªã„ã€‚
      ãƒœãƒˆãƒ ã‚¹:
        ã‚¸ãƒ¼ãƒ³ã‚º: >-
          åŸºæœ¬çš„ãªè¼ªéƒ­ç·šã®ã¿ã§æãã€ãƒã‚±ãƒƒãƒˆã®ã‚¹ãƒ†ãƒƒãƒã‚„è†ã®è£œå¼·ãƒ‘ãƒ¼ãƒ„ã¯çœç•¥ã™ã‚‹ã€‚
          ãƒ­ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã®å ´åˆã¯è£¾ã®æŠ˜ã‚Šè¿”ã—ã‚’äºŒé‡ç·šã§ç¤ºã™ã€‚
        ãƒãƒãƒ‘ãƒ³: >-
          ã‚¸ãƒ¼ãƒ³ã‚ºã‚ˆã‚Šæ»‘ã‚‰ã‹ãªè¼ªéƒ­ç·šã§æãã€ã‚»ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ¬ã‚¹ãŒã‚ã‚‹å ´åˆã¯
          ä¸€æœ¬ã®ç¸¦ç·šã§è¡¨ç¾ã™ã‚‹ãŒç‚¹ç·šã«ã¯ã—ãªã„ã€‚
        ãƒ¯ã‚¤ãƒ‰ãƒ‘ãƒ³ãƒ„: >-
          è„‡ç·šã¨è£¾ç·šã®ï¼”æœ¬ã®ã¿ã§é¢ç©ã‚’ç¢ºä¿ã—ã€
          ã‚†ã£ãŸã‚Šã¨ã—ãŸã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚’å¼·èª¿ã™ã‚‹ã€‚
        ã‚¹ã‚«ãƒ¼ãƒˆ: >-
          ãƒ•ãƒ¬ã‚¢ã€ã‚¿ã‚¤ãƒˆã€ãƒ—ãƒªãƒ¼ãƒ„ãªã©å½¢çŠ¶ã«å¿œã˜ã¦ã‚·ãƒ³ãƒ—ãƒ«ãªè¼ªéƒ­ç·šã§è¡¨ç¾ã™ã‚‹ã€‚
          ãƒ—ãƒªãƒ¼ãƒ„ã®å ´åˆã¯ä»£è¡¨çš„ãªæŠ˜ã‚Šç›®æ•°æœ¬ã®ã¿ã‚’æãã€‚
        ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹: >-
          è‚©ã‹ã‚‰è£¾ã¾ã§ä¸€ç­†æ›¸ãã§å–ã‚Šã€
          èƒ´ä½“ä¸­å¤®ã«ï¼‘æœ¬ã ã‘ã‚·ã‚§ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è½ã¨ã—ã¦ç«‹ä½“æ„Ÿã‚’æ¼”å‡ºã™ã‚‹ã€‚

    æœè£…ã®æŸ„ãƒ»è£…é£¾:
      åŸºæœ¬åŸå‰‡: >-
        æŸ„ã¯ç·šã«ã‚ˆã‚‹è¡¨ç¾ã®ã¿ã¨ã—ã€é»’ãƒ™ã‚¿é¢ã®ä¸Šã«æŸ„ã‚’é‡ã­ãªã„ã€‚
        ç·šã®å¤ªã•ã¯äººç‰©è¼ªéƒ­ã‚ˆã‚Šç´°ãã—ã¦ä¸»å¾“é–¢ä¿‚ã‚’ä¿ã¤ã€‚
      æŸ„ã®ç¨®é¡:
        ç„¡åœ°: >-
          ç™½æŠœãã¾ãŸã¯é»’ãƒ™ã‚¿ã®å˜è‰²ã§å‡¦ç†ã—ã€æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªè¡¨ç¾ã¨ã™ã‚‹ã€‚
        ã‚¹ãƒˆãƒ©ã‚¤ãƒ—: >-
          ç­‰é–“éš”ã®å¹³è¡Œç·šã§è¡¨ç¾ã—ã€ç¸¦ç¸ãƒ»æ¨ªç¸ãƒ»æ–œã‚ç¸ã«å¯¾å¿œã™ã‚‹ã€‚
          ç·šã®é–“éš”ã¯æœã®é¢ç©ã«å¿œã˜ã¦èª¿æ•´ã™ã‚‹ã€‚
        æ ¼å­ãƒ»ãƒã‚§ãƒƒã‚¯: >-
          ç¸¦æ¨ªã®ç·šã‚’çµ„ã¿åˆã‚ã›ãŸæ ¼å­ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¡¨ç¾ã™ã‚‹ã€‚
          è¤‡é›‘ãªã‚¿ãƒ¼ã‚¿ãƒ³ãƒã‚§ãƒƒã‚¯ã¯é¿ã‘ã€ã‚·ãƒ³ãƒ—ãƒ«ãªæ ¼å­ã«ç•™ã‚ã‚‹ã€‚
        ãƒ‰ãƒƒãƒˆ: >-
          å°ã•ãªå††ã®è¦å‰‡çš„ãªé…ç½®ã§è¡¨ç¾ã—ã€å¤§ãã•ã¯çµ±ä¸€ã™ã‚‹ã€‚
          å¯†åº¦ã¯æœã®é¢ç©ã¨ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã€‚
        ãƒ­ã‚´ãƒ»æ–‡å­—: >-
          èƒ¸éƒ¨ã‚„è¢–ã«é…ç½®ã—ã€é»’ãƒ™ã‚¿ã®å¡Šã¨ã—ã¦å‡¦ç†ã™ã‚‹ã€‚
          æ–‡å­—ã®è©³ç´°ã¯èª­ã‚ãªãã¦ã‚‚è‰¯ãã€å½¢çŠ¶ã®ã¿ã‚’é‡è¦–ã™ã‚‹ã€‚

    ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼é¡:
      æŒ‡é‡: >-
        ã€ŒãŠé‡‘ã‚’ä½¿ã†ç”Ÿæ´»ã‚·ãƒ¼ãƒ³ã€ã‚’æš—ç¤ºã™ã‚‹å°ç‰©ã‚’
        ä¸€äººã«ã¤ãï¼‘ã€œï¼’ç‚¹æŒãŸã›ã‚‹ã€‚
      å…·ä½“ä¾‹:
        - >-
          ãƒˆãƒ¼ãƒˆã‚„ç´™è¢‹ã¯ç™½é¢ç©ã‚’å¤§ããå–ã‚Šã€ãƒ­ã‚´ã‚’é»’ãƒ™ã‚¿ã§è¼‰ã›ã‚‹ã€‚
        - >-
          ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ã¯ã‚¤ãƒ¤ãƒ¼ã‚«ãƒƒãƒ—ã‚’é»’ã€ãƒ˜ãƒƒãƒ‰ãƒãƒ³ãƒ‰ã‚’ç™½æŠœãã®è¼ªéƒ­ã§å¯¾æ¯”ã•ã›ã‚‹ã€‚
        - >-
          ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã‚³ãƒ¼ãƒ’ãƒ¼ã¯ã‚«ãƒƒãƒ—ã‚’æ­£å††ï¼‹å††æŸ±ã§æ§‹æˆã—ã€
          ã‚¹ãƒˆãƒ­ãƒ¼ã‚„ãƒ•ã‚¿ã®ç´°ç·šã§å‹•ãã‚’è¿½åŠ ã™ã‚‹ã€‚
        - >-
          PCãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã¯è§’ä¸¸é•·æ–¹å½¢ã®ã¿ã§å®Œçµã•ã›ã€åå°„ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯æã‹ãªã„ã€‚

    ãƒãƒ¼ã‚º & å‹•ç·š:
      å…±é€šãƒ†ãƒ³ãƒ: >-
        ç¾¤åƒã‚’æãå ´åˆã¯ã€Œå…¨å“¡ãŒåŒã˜æ–¹å‘ã¸æ­©ãã€ã¾ãŸã¯
        ã€Œä¸­å¿ƒã‹ã‚‰æ¸¦çŠ¶ã«åºƒãŒã‚‹ã€ç­‰ã®å¤§ããªãƒ™ã‚¯ãƒˆãƒ«ã‚’å…±æœ‰ã—ã€
        ç”»é¢å…¨ä½“ã®è¦–ç·šèª˜å°ã‚’è¡Œã†ã€‚
      å€‹åˆ¥ãƒãƒ¼ã‚º:
        - >-
          æ­©è¡Œã¯å‰è„šã®è¸µç€åœ°ã€å¾Œè„šã®ã¤ã¾å…ˆç«‹ã¡ã§èª‡å¼µã—ã€
          ä¸¡è…•ã‚’éå¯¾ç§°ã«æŒ¯ã‚‹ã“ã¨ã§è‡ªç„¶ãªãƒ€ã‚¤ãƒŠãƒŸã‚ºãƒ ã‚’å‡ºã™ã€‚
        - >-
          é ­ã‚ˆã‚Šä¸Šã§è»½ãæ‰‹ã‚’æŒ¯ã‚‹â€œãƒãƒ­ãƒ¼â€ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã¯ã€
          æŒ‡ã‚’ä¸‰è§’å½¢çŠ¶ã®æŸã§ç°¡ç•¥åŒ–ã—ä¸€ç­†æ›¸ãã§åã‚ã‚‹ã€‚
        - >-
          è‡ªè»¢è»Šã‚„ã‚¹ã‚±ãƒœãƒ¼ãªã©ä¹—ã‚Šç‰©ã‚’ä½¿ã†å ´åˆã§ã‚‚
          è»Šè¼ªã‚„ãƒ‡ãƒƒã‚­ã¯è¼ªéƒ­ç·šã®ã¿ã§ã€é»’ãƒ™ã‚¿ã¯ä¹—ã‚Šæ‰‹ã®è¡£æœã«é›†ä¸­ã•ã›ã‚‹ã€‚

  â”€â”€â”€ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ â”€â”€â”€:
    - ç›®ã¯çœŸå††ãƒ‰ãƒƒãƒˆã§é ­é ‚ã€œé¡ã®1/3é«˜ã•ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ã€‚
    - 3/4ãƒ“ãƒ¥ãƒ¼ã®å¥¥ç›®ãŒè¼ªéƒ­ç·šã‹ã‚‰1ã€œ2pxæµ®ã„ã¦ã„ã‚‹ã‹ã€‚
    - çœ‰ãƒ»å£ãƒ»è€³ãŒä¸€åˆ‡æã‹ã‚Œã¦ã„ãªã„ã‹æœ€çµ‚ç¢ºèªã™ã‚‹ã€‚
    - é¼»ä»¥å¤–ã®é¡”å†…éƒ¨ç·šãŒå­˜åœ¨ã—ãªã„ã‹ï¼ˆã»ã†ã‚Œã„ç·šã€ã—ã‚ã€å£å…ƒã®ç·šã€å½±ç­‰ã‚‚å«ã‚€ï¼‰ã€‚
    - é¦–ãŒå¤ªãæã‹ã‚Œã€é ­éƒ¨ã¨ã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã‚‹ã‹ã€‚
    - è‚©ãŒæ¥µç«¯ãªãªã§è‚©ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ã•ã‚Œã¦ã„ã‚‹ã‹ã€‚
    - é¡”â†’é¦–â†’è‚©â†’è…•ã®æµã‚ŒãŒæ»‘ã‚‰ã‹ãªæ›²ç·šã§ç¹‹ãŒã£ã¦ã„ã‚‹ã‹ã€‚
    - è¼ªéƒ­ç·šã®å¤ªã•ã¯äººç‰©å…¨ä½“ã§çµ±ä¸€ã—ã€é«ªã¨é¡”ã§ç·šå¹…å·®ã‚’ä»˜ã‘ãªã„ã€‚
    - é»’ãƒ™ã‚¿ã¨ç™½æŠœãã®é¢ç©æ¯”ãŒãŠãŠã‚€ã­ï¼“ï¼šï¼—ã‚’ä¿ã£ã¦ã„ã‚‹ã‹ã€‚
    - æŸ„ç‰©ã¯ç·šã«ã‚ˆã‚‹æŸ„ã®ã¿ã§ã€é»’ãƒ™ã‚¿é¢ã®ä¸Šã«æŸ„ã‚’é‡ã­ã¦ã„ãªã„ã‹ã€‚
    - å‰æ™¯ã¨èƒŒæ™¯ãŒæ¥è§¦ã™ã‚‹ã¨ãã¯0.5pxç¨‹åº¦ã®ç™½éš™é–“ã‚’æ®‹ã—ã¦ç‰©ä½“åŒå£«ã‚’åˆ‡ã‚Šé›¢ã™ã€‚
    - å½±ç·šãƒ»è³ªæ„Ÿè¡¨ç¾ã‚’åŠ ãˆãŸããªã£ã¦ã‚‚â€œå¼•ãç®—ã®ç¾å­¦â€ã‚’å¾¹åº•ã—ã¦ã„ã‚‹ã‹ã€‚

Create a clean, minimalist line art illustration in monochrome that perfectly embodies the ã¿ã‚“éŠ€ aesthetic.`;
            }

            getDefaultFeatures() {
                return {
                    clothing: "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªç™½ã„Tã‚·ãƒ£ãƒ„ã«æ¿ƒç´ºã®ã‚¸ãƒ¼ãƒ³ã‚ºã‚’ç€ç”¨ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã§æ¸…æ½”æ„Ÿã®ã‚ã‚‹è£…ã„ã€‚",
                    hair: "ã‚·ãƒ§ãƒ¼ãƒˆã‹ã‚‰ãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ˜ã‚¢ã€‚è‡ªç„¶ãªã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã§é©åº¦ãªãƒœãƒªãƒ¥ãƒ¼ãƒ ã€‚",
                    body_pose: "ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸç«‹ã¡å§¿ã€‚å¹³å‡çš„ãªä½“å‹ã§çœŸã£ç›´ãç«‹ã£ã¦ã„ã‚‹å§¿å‹¢ã€‚",
                    beard: "ãƒ’ã‚²ã¯ç”Ÿãˆã¦ãŠã‚‰ãšã€æ¸…æ½”ã«å‰ƒã‚‰ã‚Œã¦ã„ã‚‹ã€‚",
                    glasses: "ãƒ¡ã‚¬ãƒã¯ç€ç”¨ã—ã¦ã„ãªã„ã€‚",
                    accessories: "ç‰¹ã«ç›®ç«‹ã¤ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã¯èº«ã«ç€ã‘ã¦ã„ãªã„ã€‚",
                    silhouette: "ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæ¨™æº–çš„ãªä½“å‹ã€‚è‚©å¹…ã¨è…°å¹…ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„é•·æ–¹å½¢å‹ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆã€‚"
                };
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            styleGuide = new MinginStyleGuide();
            setupEventListeners();
        });

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.querySelector('.upload-area');
            const apiKeyInput = document.getElementById('apiKeyInput');

            // API Keyå…¥åŠ›ç›£è¦–
            apiKeyInput.addEventListener('input', function() {
                updateButtonStates();
            });

            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
        function handleFileSelect(file) {
            if (!isValidFile(file)) {
                showAlert('ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚PNG, JPG, JPEG, GIF ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', 'error');
                return;
            }

            if (file.size > 16 * 1024 * 1024) {
                showAlert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆæœ€å¤§16MBï¼‰', 'error');
                return;
            }

            displayFilePreview(file);
            updateButtonStates();
            
            // è‡ªå‹•ã§ç‰¹å¾´æŠ½å‡ºã¨ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆã‚’å®Ÿè¡Œ
            autoProcessImage();
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
        function isValidFile(file) {
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif'];
            return allowedTypes.includes(file.type);
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        function displayFilePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const existingPreview = document.querySelector('.preview-image');
                if (existingPreview) {
                    existingPreview.remove();
                }
                
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'preview-image';
                document.querySelector('.upload-area').appendChild(img);
                
                document.querySelector('.upload-area p').innerHTML = `ğŸ“¸ é¸æŠã•ã‚ŒãŸç”»åƒ: ${file.name}`;
            };
            reader.readAsDataURL(file);
        }

        // ã‚¹ãƒ†ãƒƒãƒ—çŠ¶æ…‹ç®¡ç†
        function updateStepState(stepNumber, state) {
            const step = document.getElementById(`step${stepNumber}`);
            step.classList.remove('active', 'completed');
            
            if (state === 'active') {
                step.classList.add('active');
            } else if (state === 'completed') {
                step.classList.add('completed');
            }
        }

        // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
        function updateButtonStates() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const fileSelected = document.getElementById('fileInput').files.length > 0;

            // ã‚¹ãƒ†ãƒƒãƒ—çŠ¶æ…‹æ›´æ–°
            if (apiKey && fileSelected) {
                updateStepState(1, 'active');
            }
            
            if (currentFeatures) {
                updateStepState(1, 'completed');
                updateStepState(2, 'active');
            }
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.api-key-section'));
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºåˆ¶å¾¡
        function setLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // è‡ªå‹•å‡¦ç†å®Ÿè¡Œ
        async function autoProcessImage() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                showAlert('OpenAI API Keyã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                // Step1: ç‰¹å¾´æŠ½å‡ºã‚’è‡ªå‹•å®Ÿè¡Œ
                await analyzeImage();
                
                // Step2: ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆã‚’è‡ªå‹•å®Ÿè¡Œ
                await generateIllustration();
                
            } catch (error) {
                console.error('Auto process error:', error);
                showAlert(`è‡ªå‹•å‡¦ç†ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // Base64å¤‰æ›
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // ç”»åƒè§£æ
        async function analyzeImage() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const fileInput = document.getElementById('fileInput');
            
            if (!apiKey) {
                showAlert('OpenAI API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (!fileInput.files.length) {
                showAlert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const file = fileInput.files[0];
            
            try {
                setLoading(true);

                const base64Image = await fileToBase64(file);
                console.log('ğŸ” Base64 Image Length:', base64Image.length);
                
                const prompt = styleGuide.generateAnalysisPrompt();
                console.log('ğŸ” Analysis Prompt:', prompt);

                const requestBody = JSON.stringify({
                    model: "gpt-4o",
                    messages: [{
                        role: "user",
                        content: [
                            { type: "text", text: prompt },
                            { 
                                type: "image_url", 
                                image_url: { 
                                    url: `data:image/jpeg;base64,${base64Image}` 
                                }
                            }
                        ]
                    }],
                    max_tokens: 1000
                });

                console.log('ğŸ” Request Body Structure:', {
                    model: "gpt-4o",
                    messages: "Array with text and image",
                    max_tokens: 1000
                });

                const encoder = new TextEncoder();
                const encodedBody = encoder.encode(requestBody);

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: encodedBody
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                console.log('ğŸ” Full API Response:', data);
                
                const content = data.choices[0].message.content;
                console.log('ğŸ” GPT-4o Response Content:', content);

                // JSONã‚’æŠ½å‡º
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    console.error('âŒ JSON not found in response:', content);
                    throw new Error('æœ‰åŠ¹ãªJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }

                console.log('ğŸ” Extracted JSON String:', jsonMatch[0]);
                currentFeatures = JSON.parse(jsonMatch[0]);
                console.log('âœ… Parsed Features:', currentFeatures);
                
                // çµæœè¡¨ç¤º
                document.getElementById('featuresResult').textContent = JSON.stringify(currentFeatures, null, 2);
                
                // ç‰¹å¾´è¦ç´„ã‚’ç”Ÿæˆãƒ»è¡¨ç¤º
                const summary = styleGuide.summarizeFeatures(currentFeatures);
                const formattedFeatures = styleGuide.formatFeatures(summary);
                document.getElementById('yamlResult').textContent = formattedFeatures;
                
                // Step1ã®çµæœã‚’è¡¨ç¤º
                document.getElementById('step1Results').style.display = 'block';
                
                showAlert('äººç‰©ã®ç‰¹å¾´æŠ½å‡ºãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                updateButtonStates();

            } catch (error) {
                console.error('âŒ Analysis error:', error);
                console.log('âš ï¸ Using default features due to error');
                showAlert(`ç‰¹å¾´æŠ½å‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç‰¹å¾´ã‚’ä½¿ç”¨
                currentFeatures = styleGuide.getDefaultFeatures();
                console.log('ğŸ”„ Default Features:', currentFeatures);
                document.getElementById('featuresResult').textContent = JSON.stringify(currentFeatures, null, 2);
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç‰¹å¾´ã§è¦ç´„ã‚’ç”Ÿæˆãƒ»è¡¨ç¤º
                const summary = styleGuide.summarizeFeatures(currentFeatures);
                const formattedFeatures = styleGuide.formatFeatures(summary);
                document.getElementById('yamlResult').textContent = formattedFeatures;
                
                // Step1ã®çµæœã‚’è¡¨ç¤º
                document.getElementById('step1Results').style.display = 'block';
                showAlert('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ç¶šè¡Œã—ã¾ã™', 'warning');
                updateButtonStates();
                
            } finally {
                setLoading(false);
            }
        }

        // ã‚¤ãƒ©ã‚¹ãƒˆç”Ÿæˆ
        async function generateIllustration() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                showAlert('OpenAI API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (!currentFeatures) {
                showAlert('ã¾ãšäººç‰©ã®ç‰¹å¾´æŠ½å‡ºã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                setLoading(true);

                const prompt = styleGuide.generateIllustrationPrompt(currentFeatures);
                document.getElementById('promptResult').textContent = prompt;
                
                const selectedQuality = document.getElementById('qualitySelect').value;

                const requestBody = JSON.stringify({
                    model: "gpt-image-1",
                    prompt: prompt,
                    size: "1024x1024",
                    quality: selectedQuality,
                    output_format: "png",
                    n: 1
                });

                const encoder = new TextEncoder();
                const encodedBody = encoder.encode(requestBody);

                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: encodedBody
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                console.log('Full API response:', data);
                
                if (!data.data || data.data.length === 0) {
                    console.error('No image data in response:', data);
                    throw new Error('ç”»åƒãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                }

                const imageData = data.data[0];
                console.log('Image data object:', imageData);
                console.log('Available properties:', Object.keys(imageData));
                
                let imageUrl;

                if (imageData.url) {
                    console.log('Using URL:', imageData.url);
                    imageUrl = imageData.url;
                } else if (imageData.b64_json) {
                    console.log('Using base64 data');
                    imageUrl = `data:image/png;base64,${imageData.b64_json}`;
                } else if (imageData.data) {
                    console.log('Using embedded data field');
                    imageUrl = `data:image/png;base64,${imageData.data}`;
                } else {
                    console.error('No usable image data found. Available keys:', Object.keys(imageData));
                    throw new Error('ç”»åƒURLã¾ãŸã¯Base64ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }

                console.log('Final image URL:', imageUrl.substring(0, 100) + '...');

                // ç”»åƒè¡¨ç¤º
                const imageContainer = document.getElementById('generatedImage');
                imageContainer.innerHTML = `
                    <img src="${imageUrl}" alt="Generated Illustration" 
                         onload="console.log('Image loaded successfully')" 
                         onerror="console.error('Image load failed:', this.src.substring(0, 100));">
                    <br><br>
                    <a href="${imageUrl}" target="_blank" class="btn">ğŸ”— ãƒ•ãƒ«ã‚µã‚¤ã‚ºã§è¡¨ç¤º</a>
                `;

                // Step2ã®çµæœã‚’è¡¨ç¤º
                document.getElementById('step2Results').style.display = 'block';
                
                // Step2ã‚’å®Œäº†çŠ¶æ…‹ã«
                updateStepState(2, 'completed');

                showAlert('ã‚¤ãƒ©ã‚¹ãƒˆç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');

            } catch (error) {
                console.error('Generation error:', error);
                showAlert(`ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                
            } finally {
                setLoading(false);
            }
        }
    </script>
</body>
</html>